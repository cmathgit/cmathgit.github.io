<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Espa√±ol Acad√©mico: Filosof√≠a y Antropolog√≠a ‚Äî App (1 archivo)</title>
  <style>
    :root{
      --bg:#0b0f14; --panel:#111827; --muted:#6b7280; --text:#e5e7eb; --accent:#38bdf8; --accent2:#a78bfa; --ok:#34d399; --warn:#f59e0b; --err:#ef4444;
      --card:#0f172a; --surface:#0b1220; --border:#1f2937; --chip:#1c263d;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0;font:16px/1.5 ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,Noto Sans,sans-serif;background:linear-gradient(180deg,#0b0f14,#0b1220 40%,#0b0f14);color:var(--text)}
    header{position:sticky;top:0;z-index:10;background:rgba(11,18,32,.8);backdrop-filter:saturate(140%) blur(6px);border-bottom:1px solid var(--border)}
    .wrap{max-width:1200px;margin:0 auto;padding:16px}
    .title{display:flex;gap:12px;align-items:center}
    .title h1{margin:0;font-size:20px;letter-spacing:.4px}
    .badge{font-size:12px;color:#c7d2fe;background:rgba(167,139,250,.1);padding:2px 8px;border:1px solid #3b2f66;border-radius:999px}
    nav{display:flex;gap:8px;flex-wrap:wrap;margin-top:10px}
    nav button{background:var(--chip);border:1px solid var(--border);color:var(--text);padding:8px 12px;border-radius:10px;cursor:pointer}
    nav button[aria-current="page"]{background:linear-gradient(90deg,rgba(56,189,248,.15),rgba(167,139,250,.15));border-color:#334155}
    main{max-width:1200px;margin:0 auto;padding:16px;}
    section{display:none}
    section.active{display:block;animation:fade .25s ease}
    @keyframes fade{from{opacity:0;transform:translateY(4px)}to{opacity:1;transform:translateY(0)}}

    .card{background:var(--panel);border:1px solid var(--border);border-radius:16px;padding:16px;box-shadow:0 10px 30px rgba(0,0,0,.25)}
    .grid{display:grid;gap:16px}
    .g-2{grid-template-columns:repeat(2,minmax(0,1fr))}
    .g-3{grid-template-columns:repeat(3,minmax(0,1fr))}
    .g-4{grid-template-columns:repeat(4,minmax(0,1fr))}
    @media(max-width:1000px){.g-3,.g-4{grid-template-columns:repeat(2,1fr)}.g-2{grid-template-columns:1fr}}
    @media(max-width:700px){.g-3,.g-4{grid-template-columns:1fr}}

    input,select,textarea{width:100%;padding:10px;background:#0b1220;border:1px solid var(--border);border-radius:10px;color:var(--text)}
    textarea{min-height:120px}
    label{display:block;font-size:12px;color:var(--muted);margin-bottom:6px}
    .row{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
    .btn{background:linear-gradient(90deg,rgba(56,189,248,.2),rgba(167,139,250,.2));border:1px solid #334155;color:var(--text);padding:8px 12px;border-radius:10px;cursor:pointer}
    .btn:disabled{opacity:.6;cursor:not-allowed}
    .btn.primary{background:linear-gradient(90deg,rgba(56,189,248,.35),rgba(56,189,248,.2));border-color:#3b82f6}
    .btn.good{background:rgba(52,211,153,.2);border-color:#065f46}
    .btn.warn{background:rgba(245,158,11,.15);border-color:#7c2d12}
    .btn.danger{background:rgba(239,68,68,.17);border-color:#7f1d1d}

    table{width:100%;border-collapse:separate;border-spacing:0;overflow:hidden;border-radius:12px;border:1px solid var(--border)}
    th,td{padding:10px;border-bottom:1px solid var(--border);vertical-align:top}
    th{background:#0f172a;text-align:left;color:#cbd5e1}
    tr:nth-child(even) td{background:#0b1220}
    .pill{display:inline-flex;align-items:center;gap:6px;padding:2px 8px;border:1px solid var(--border);border-radius:999px;background:#0b1220;color:#cbd5e1;font-size:12px;margin-right:6px}
    .muted{color:var(--muted)}
    .hint{font-size:12px;color:#9ca3af}
    .kbd{padding:2px 6px;border:1px solid var(--border);border-bottom-width:2px;background:#0b1220;border-radius:6px;font-family:ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, monospace;font-size:12px}
    .progress{height:8px;background:#0b1220;border:1px solid var(--border);border-radius:999px;overflow:hidden}
    .progress>i{display:block;height:100%;background:linear-gradient(90deg,var(--accent),var(--accent2));width:0%}
    .chips{display:flex;gap:8px;flex-wrap:wrap}
    .chip{background:#0b1220;border:1px solid var(--border);padding:6px 10px;border-radius:999px;font-size:12px;color:var(--text);cursor:pointer}
    .right{margin-left:auto}
    .mono{font-family:ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, monospace}
    .small{font-size:12px}
    .center{text-align:center}
    .wave{height:70px;background:#0b1220;border:1px solid var(--border);border-radius:10px;position:relative;overflow:hidden}
    canvas{display:block}
  </style>
</head>
<body>
<header>
  <div class="wrap">
    <div class="title">
      <svg width="24" height="24" viewBox="0 0 24 24" fill="none"><path d="M3 19l9-15 9 15H3z" stroke="url(#g)" stroke-width="1.5"/><defs><linearGradient id="g" x1="0" x2="24" y1="0" y2="24"><stop stop-color="#38bdf8"/><stop offset="1" stop-color="#a78bfa"/></linearGradient></defs></svg>
      <h1>Espa√±ol Acad√©mico ‚Äî Filosof√≠a & Antropolog√≠a</h1>
      <span class="badge">App local (1 archivo)</span>
      <span class="right small muted">Consejo: use aud√≠fonos y active un <span class="kbd">voz: es‚ÄëES</span> en su sistema.</span>
    </div>
    <nav id="nav"></nav>
  </div>
</header>

<main>
  <!-- Dashboard -->
  <section id="sec-dashboard" class="active">
    <div class="grid g-3">
      <div class="card">
        <h2>Itinerario sugerido</h2>
        <ol>
          <li>Escuche un <strong>di√°logo de seminario</strong> y responda en voz alta.</li>
          <li>Practique <strong>shadowing</strong> con un resumen acad√©mico.</li>
          <li>Repase 10 tarjetas del <strong>l√©xico especializado</strong>.</li>
          <li>Escriba un p√°rrafo con el <strong>Laboratorio de escritura</strong> y eleve el registro.</li>
        </ol>
        <div class="progress" aria-label="Meta diaria"><i id="progressBar"></i></div>
        <p class="hint">El progreso se guarda en su navegador (localStorage).</p>
      </div>
      <div class="card">
        <h2>Comandos r√°pidos</h2>
        <div class="chips">
          <button class="chip" onclick="say('es-ES','Buenos d√≠as. Comencemos con una breve exposici√≥n sobre epistemolog√≠a social.')">‚ñ∂Ô∏é Saludo</button>
          <button class="chip" onclick="startSeminar()">‚ñ∂Ô∏é Seminario</button>
          <button class="chip" onclick="openTab('lexicon')">üìö L√©xico</button>
          <button class="chip" onclick="openTab('shadow')">üéß Shadowing</button>
          <button class="chip" onclick="openTab('drills')">üß† Repaso</button>
        </div>
        <p class="hint">Use <span class="kbd">Espacio</span> para pausar/reanudar TTS. <span class="kbd">M</span> para micr√≥fono.</p>
      </div>
      <div class="card">
        <h2>Estado del sistema</h2>
        <ul id="sysStatus" class="small"></ul>
      </div>
    </div>
  </section>

  <!-- Lexicon -->
  <section id="sec-lexicon">
    <div class="card">
      <div class="row">
        <div style="flex:2">
          <label>Buscar t√©rmino o ejemplo</label>
          <input id="lexSearch" placeholder="p.ej., 'epistemolog√≠a', 'campo', 'agencia', 'Genealog√≠a de la moral'" />
        </div>
        <div style="flex:1">
          <label>Dominio</label>
          <select id="lexDomain"><option value="">Todos</option><option>Filosof√≠a</option><option>Antropolog√≠a</option></select>
        </div>
        <div style="flex:1">
          <label>Modo de tarjetas</label>
          <select id="lexMode"><option value="es-en">ES ‚Üí EN</option><option value="en-es">EN ‚Üí ES</option></select>
        </div>
      </div>
      <div class="row" style="margin-top:10px">
        <button class="btn primary" onclick="renderLexicon()">Filtrar</button>
        <button class="btn" onclick="startSRSFromLexicon()">A√±adir a repaso (todo filtrado)</button>
        <span class="right hint" id="lexCount"></span>
      </div>
    </div>

    <div class="card" style="margin-top:16px">
      <table id="lexTable" aria-label="L√©xico"></table>
    </div>
  </section>

  <!-- Drills / SRS -->
  <section id="sec-drills">
    <div class="grid g-2">
      <div class="card">
        <h2>Tarjetas (SRS)</h2>
        <div id="srsCard">
          <p class="muted">Sin tarjetas por ahora. A√±ada desde el L√©xico o use el generador.</p>
        </div>
        <div class="row" style="margin-top:10px">
          <button class="btn" onclick="srsGenerateSample()">Generar muestra</button>
          <button class="btn warn" onclick="resetSRS()">Reiniciar SRS</button>
          <span class="right hint" id="srsInfo"></span>
        </div>
      </div>
      <div class="card">
        <h2>Cloze & Usos acad√©micos</h2>
        <div class="row">
          <select id="clozeSrc"></select>
          <button class="btn" onclick="makeCloze()">Crear cloze</button>
        </div>
        <div id="clozeArea" style="margin-top:10px"></div>
        <p class="hint">Objetivo: dominar conectores, hedging, voz pasiva/impersonal y per√≠frasis aspectuales.</p>
      </div>
    </div>
  </section>

  <!-- Dialogues -->
  <section id="sec-dialogues">
    <div class="card">
      <div class="row">
        <div style="flex:1">
          <label>Escenario</label>
          <select id="dialogueSelect"></select>
        </div>
        <div class="row right">
          <button class="btn" onclick="playDialogue()">‚ñ∂Ô∏é Escuchar</button>
          <button class="btn" onclick="toggleMic()">üéôÔ∏è Responder</button>
          <button class="btn" onclick="stopAllAudio()">‚è∏Ô∏è Parar</button>
        </div>
      </div>
      <div id="dialogueArea" style="margin-top:10px"></div>
      <p class="hint">Consejo: responda en espa√±ol; el sistema puede transcribir (si el navegador lo permite) y calcular su velocidad (ppm) y densidad l√©xica.</p>
    </div>
  </section>

  <!-- Shadowing / Pronunciaci√≥n -->
  <section id="sec-shadow">
    <div class="grid g-2">
      <div class="card">
        <h2>Shadowing de res√∫menes acad√©micos</h2>
        <div class="row">
          <select id="shadowSelect"></select>
          <button class="btn" onclick="ttsShadow()">‚ñ∂Ô∏é Escuchar</button>
          <button class="btn" onclick="recShadow()">üéôÔ∏è Grabar</button>
          <button class="btn" onclick="stopAllAudio()">‚èπÔ∏è</button>
        </div>
        <div class="wave"><canvas id="waveCanvas" width="600" height="70"></canvas></div>
        <div id="shadowText" style="margin-top:10px"></div>
        <div class="row" style="margin-top:10px">
          <div class="pill">Duraci√≥n: <span id="dur">0.0</span>s</div>
          <div class="pill">Palabras: <span id="wcount">0</span></div>
          <div class="pill">PPM: <span id="wpm">0</span></div>
          <div class="pill">RMS: <span id="rms">0.00</span></div>
        </div>
      </div>
      <div class="card">
        <h2>Banco de f√≥rmulas ret√≥ricas</h2>
        <div id="phraseBank"></div>
      </div>
    </div>
  </section>

  <!-- Writing Lab -->
  <section id="sec-writing">
    <div class="grid g-2">
      <div class="card">
        <h2>Laboratorio de escritura: Elevar registro</h2>
        <label>Entrada (ES)</label>
        <textarea id="writeIn" placeholder="Escriba aqu√≠ su p√°rrafo en espa√±ol‚Ä¶"></textarea>
        <div class="row" style="margin-top:8px">
          <button class="btn primary" onclick="elevateRegister()">Elevar registro</button>
          <button class="btn" onclick="paraphraseHedge()">A√±adir hedging</button>
          <button class="btn" onclick="formalizeCitations()">Formatear marcadores y latinismos</button>
        </div>
      </div>
      <div class="card">
        <h2>Salida</h2>
        <textarea id="writeOut" placeholder="Salida transformada‚Ä¶"></textarea>
        <p class="hint">La transformaci√≥n aplica sustituciones formales, conectores, pasiva/impersonal y atenuadores. Revise adecuaci√≥n sem√°ntica.</p>
      </div>
    </div>

    <div class="card" style="margin-top:16px">
      <h2>Plantillas acad√©micas</h2>
      <div class="grid g-3" id="tpls"></div>
    </div>
  </section>

  <!-- Grammar / Reference -->
  <section id="sec-grammar">
    <div class="card">
      <h2>Comparativa r√°pida</h2>
      <table>
        <thead><tr><th>Fen√≥meno</th><th>Uso en espa√±ol acad√©mico</th><th>Ejemplo</th><th>Notas</th></tr></thead>
        <tbody id="compTable"></tbody>
      </table>
    </div>
  </section>

  <!-- Settings & Progress -->
  <section id="sec-settings">
    <div class="grid g-2">
      <div class="card">
        <h2>Voz y micr√≥fono</h2>
        <div class="row">
          <div style="flex:1">
            <label>Voz TTS (es)</label>
            <select id="voiceSelect"></select>
          </div>
          <div class="row" style="gap:6px">
            <button class="btn" onclick="testVoice()">Probar</button>
            <button class="btn" onclick="toggleMic()">Micr√≥fono</button>
          </div>
        </div>
        <p id="permInfo" class="hint"></p>
      </div>
      <div class="card">
        <h2>Datos & copia de seguridad</h2>
        <div class="row">
          <button class="btn" onclick="exportData()">Exportar JSON</button>
          <input type="file" id="importFile" accept="application/json"/>
          <button class="btn" onclick="importData()">Importar</button>
        </div>
        <p class="hint">Se exportan progreso SRS, opciones y historial.</p>
      </div>
    </div>
  </section>
  <footer class="wrap muted small" style="padding-bottom:40px">
    <p>Dise√±o orientado a competencias comunicativas acad√©micas: precisi√≥n terminol√≥gica, organizaci√≥n argumentativa, control de registro y prosodia. Funciona totalmente local (sin servidor). Algunas funciones de voz requieren HTTPS/navegador compatible.</p>
    <div class="small">Powered by GPT-5</div>
  </footer>
</main>

<script>
// ======= Navegaci√≥n =======
const tabs = [
  {id:'dashboard', label:'Panel'},
  {id:'lexicon', label:'L√©xico'},
  {id:'drills', label:'Repaso'},
  {id:'dialogues', label:'Di√°logos'},
  {id:'shadow', label:'Shadowing'},
  {id:'writing', label:'Escritura'},
  {id:'grammar', label:'Gram√°tica'},
  {id:'settings', label:'Ajustes'}
];
const navEl = document.getElementById('nav');
const sections = Object.fromEntries(tabs.map(t=>[t.id, document.getElementById('sec-'+t.id)]));
function renderNav(){
  navEl.innerHTML = '';
  tabs.forEach(t=>{
    const b = document.createElement('button');
    b.textContent = t.label; b.onclick = ()=>openTab(t.id);
    b.setAttribute('aria-current', sections[t.id].classList.contains('active') ? 'page' : 'false');
    navEl.appendChild(b);
  });
}
function openTab(id){
  Object.values(sections).forEach(s=>s.classList.remove('active'));
  sections[id].classList.add('active');
  renderNav();
  if(id==='lexicon') renderLexicon();
}
renderNav();

// ======= Datos: L√©xico especializado (muestra curada) =======
const LEXICON = [
  // Filosof√≠a
  {id:1,dom:'Filosof√≠a',es:'epistemolog√≠a social',en:'social epistemology',def:'Rama que estudia las dimensiones sociales del conocimiento y la justificaci√≥n.',ex:'La epistemolog√≠a social analiza c√≥mo influyen las instituciones en la producci√≥n de conocimiento.',ipa:'epi.ste.mo.loÀàxia soÀàŒ∏jal',col:['justificaci√≥n','credibilidad testimonial'],note:'No confundir con sociolog√≠a del conocimiento.'},
  {id:2,dom:'Filosof√≠a',es:'ontolog√≠a',en:'ontology',def:'Estudio de lo que existe y de las categor√≠as del ser.',ex:'La ontolog√≠a de procesos difiere de la de sustancias.',ipa:'on.to.loÀàxia',col:['ser','entidad','categor√≠a'],note:''},
  {id:3,dom:'Filosof√≠a',es:'teleolog√≠a',en:'teleology',def:'Explicaci√≥n por fines o prop√≥sitos.',ex:'Las lecturas teleol√≥gicas de Arist√≥teles han sido revisadas cr√≠ticamente.',ipa:'te.le.o.loÀàxia',col:['finalidad','prop√≥sito'],note:''},
  {id:4,dom:'Filosof√≠a',es:'razonamiento abductivo',en:'abductive reasoning',def:'Inferencia a la mejor explicaci√≥n.',ex:'El razonamiento abductivo gu√≠a la selecci√≥n de hip√≥tesis.',ipa:'ra.Œ∏o.naÀàmjento aŒ≤.dukÀàtiŒ≤o',col:['hip√≥tesis','explicaci√≥n'],note:'Tambi√©n ‚Äúabducci√≥n‚Äù.'},
  {id:5,dom:'Filosof√≠a',es:'realismo cient√≠fico',en:'scientific realism',def:'Tesis seg√∫n la cual las teor√≠as cient√≠ficas describen (aprox.) entidades reales.',ex:'El realismo cient√≠fico contrasta con el instrumentalismo.',ipa:'re.aÀàlis.mo Œ∏jenÀàtifi.ko',col:['referencia','verdad'],note:''},
  {id:6,dom:'Filosof√≠a',es:'fenomenolog√≠a',en:'phenomenology',def:'M√©todo y tradici√≥n que describe la experiencia desde la primera persona.',ex:'La fenomenolog√≠a husserliana influye en la hermen√©utica.',ipa:'fe.no.me.noÀàloxja',col:['intencionalidad','vivencia'],note:''},
  {id:7,dom:'Filosof√≠a',es:'epistemicidio',en:'epistemicide',def:'Destrucci√≥n sistem√°tica de formas de conocimiento.',ex:'La colonizaci√≥n produjo epistemicidios m√∫ltiples.',ipa:'e.pis.te.miÀàŒ∏i√∞jo',col:['colonialidad','saber'],note:''},
  {id:8,dom:'Filosof√≠a',es:'pragm√°tica inferencial',en:'inferential pragmatics',def:'Modelo que explica c√≥mo se infiere el significado m√°s all√° del literal.',ex:'La pragm√°tica inferencial explica los actos de habla acad√©micos.',ipa:'p…æa…£Ààmatika',col:['implicatura','relevancia'],note:''},
  {id:9,dom:'Filosof√≠a',es:'meta√©tica',en:'metaethics',def:'Estudio de la naturaleza del juicio moral y su justificaci√≥n.',ex:'El no-cognitivismo es una postura cl√°sica en meta√©tica.',ipa:'metaÀàetika',col:['normatividad','valor'],note:''},
  {id:10,dom:'Filosof√≠a',es:'problema de la demarcaci√≥n',en:'demarcation problem',def:'Criterios para distinguir ciencia de no-ciencia.',ex:'Popper abord√≥ el problema de la demarcaci√≥n mediante la falsabilidad.',ipa:'de.ma…æ.kaÀàŒ∏jon',col:['falsaci√≥n','pseudociencia'],note:''},
  {id:11,dom:'Filosof√≠a',es:'teor√≠a de la mente extendida',en:'extended mind thesis',def:'Hip√≥tesis seg√∫n la cual procesos cognitivos se extienden a artefactos.',ex:'Las libretas pueden ser parte de la mente extendida.',ipa:'men.de ekstenÀàdi√∞Ãûa',col:['cognici√≥n','entorno'],note:''},
  {id:12,dom:'Filosof√≠a',es:'giro ling√º√≠stico',en:'linguistic turn',def:'Orientaci√≥n que prioriza el an√°lisis del lenguaje en filosof√≠a.',ex:'El giro ling√º√≠stico cambi√≥ la metodolog√≠a filos√≥fica del s. XX.',ipa:'Ààxi…æo li≈ãÀà…°wistiko',col:['anal√≠tica','significado'],note:''},

  // Antropolog√≠a
  {id:101,dom:'Antropolog√≠a',es:'trabajo de campo',en:'fieldwork',def:'Investigaci√≥n emp√≠rica prolongada en un contexto sociocultural.',ex:'El trabajo de campo requiere observaci√≥n participante.',ipa:'t…æaÀàŒ≤axo √∞e Ààkampo',col:['etnograf√≠a','diario'],note:''},
  {id:102,dom:'Antropolog√≠a',es:'observaci√≥n participante',en:'participant observation',def:'T√©cnica en la que el investigador participa en la vida social estudiada.',ex:'La observaci√≥n participante facilita el acceso a significados nativos.',ipa:'oŒ≤se…æŒ≤aÀàŒ∏jon pa…ætiŒ∏iÀàpante',col:['inmersi√≥n','reflexividad'],note:''},
  {id:103,dom:'Antropolog√≠a',es:'reflexividad',en:'reflexivity',def:'Reconocimiento anal√≠tico de la posici√≥n del investigador.',ex:'La reflexividad evita naturalizar categor√≠as anal√≠ticas.',ipa:'refleksiŒ≤iÀà√∞a√∞',col:['posicionalidad','√©tica'],note:''},
  {id:104,dom:'Antropolog√≠a',es:'etnohistoria',en:'ethnohistory',def:'An√°lisis hist√≥rico con fuentes y perspectivas ind√≠genas.',ex:'La etnohistoria dialoga con la arqueolog√≠a.',ipa:'etnojisÀàt…æja',col:['archivo','oralidad'],note:''},
  {id:105,dom:'Antropolog√≠a',es:'cultura material',en:'material culture',def:'Objetos y pr√°cticas materiales como portadores de significado.',ex:'La cultura material ilumina econom√≠as morales.',ipa:'kulÀàtu…æa mateÀà…æjal',col:['artefacto','uso'],note:''},
  {id:106,dom:'Antropolog√≠a',es:'parentesco',en:'kinship',def:'Sistemas de filiaci√≥n, alianza y terminolog√≠as de relaci√≥n.',ex:'El parentesco ficticio organiza redes urbanas.',ipa:'pa…æenÀàtesko',col:['linaje','alianza'],note:''},
  {id:107,dom:'Antropolog√≠a',es:'econom√≠a moral',en:'moral economy',def:'Normas compartidas que estructuran el intercambio y la subsistencia.',ex:'Las protestas se explican por una econom√≠a moral vulnerada.',ipa:'ekoÀànomia moÀà…æal',col:['reciprocidad','justicia'],note:''},
  {id:108,dom:'Antropolog√≠a',es:'tecnolog√≠as del yo',en:'technologies of the self',def:'Pr√°cticas mediante las que los sujetos se constituyen.',ex:'Las dietas son tecnolog√≠as del yo contempor√°neas.',ipa:'teknoÀàloxjas √∞el  ùo',col:['gubernamentalidad','cuidado de s√≠'],note:'Foucault.'},
  {id:109,dom:'Antropolog√≠a',es:'multiespecies',en:'multispecies',def:'Enfoque que estudia relaciones interespecie en mundos compartidos.',ex:'La etnograf√≠a multiespecies desborda lo humano.',ipa:'mul.tjesÀàpe.sjes',col:['ecolog√≠a','agencia no humana'],note:''},
  {id:110,dom:'Antropolog√≠a',es:'arqueolog√≠a industrial',en:'industrial archaeology',def:'Estudio de paisajes, infraestructuras y objetos industriales.',ex:'La arqueolog√≠a industrial reinterpreta el patrimonio obrero.',ipa:'a…ækeoloÀàxia in√∞usÀàt…æjal',col:['patrimonio','archivo'],note:''},
];

// Pasajes para shadowing
const PASSAGES = [
  {id:'philo-abs', title:'Resumen: epistemolog√≠a y testimonio', text:`Este trabajo indaga c√≥mo se distribuye de manera desigual la credibilidad testimonial en instituciones cient√≠ficas. Sostengo que los sesgos estructurales generan circuitos de exclusi√≥n que empobrecen la deliberaci√≥n. Propongo, por ello, mecanismos epist√©micos de reparaci√≥n orientados a la ampliaci√≥n de voces competentes.`},
  {id:'anthro-abs', title:'Resumen: etnograf√≠a urbana', text:`Con base en un a√±o de trabajo de campo, describo la ecolog√≠a moral de un mercado perif√©rico. Muestro c√≥mo la reciprocidad y el endeudamiento afectivo sostienen redes de subsistencia, a la vez que producen tensiones pol√≠ticas en torno a la dignidad y el reconocimiento.`},
  {id:'logic-abs', title:'Resumen: inferencia abductiva', text:`Defiendo que la abducci√≥n, lejos de ser mera conjetura, est√° normada por restricciones de simplicidad, cobertura y robustez contraf√°ctica. El argumento principal se apoya en estudios de caso hist√≥ricos y en simulaciones bayesianas.`},
];

// Di√°logos
const DIALOGUES = [
  { id:'seminario', label:'Seminario: discusi√≥n de art√≠culo', turns:[
    {role:'prof', say:'Para iniciar, ¬øpodr√≠a sintetizar la tesis del art√≠culo en dos o tres frases y situarla en el debate actual?'},
    {role:'prof', say:'Ha mencionado la noci√≥n de ‚Äúeconom√≠a moral‚Äù. ¬øC√≥mo se distingue aqu√≠ de inter√©s propio y de altruismo?'},
    {role:'prof', say:'Concedamos su objeci√≥n. Sin embargo, ¬øqu√© predicciones emp√≠ricas se seguir√≠an de su hip√≥tesis alternativa?'},
    {role:'prof', say:'Para cerrar, proponga una extensi√≥n metodol√≥gica factible para replicar el estudio en otro contexto.'}
  ]},
  { id:'panel', label:'Panel de congreso: r√©plica y contra-r√©plica', turns:[
    {role:'moder', say:'Tiene tres minutos para responder a la cr√≠tica sobre validez externa.'},
    {role:'moder', say:'Gracias. Ahora, ¬øpodr√≠a precisar sus supuestos causales y c√≥mo los testea?'},
    {role:'moder', say:'√öltima intervenci√≥n: indique una limitaci√≥n y su plan para atenderla.'}
  ]},
  { id:'entrevista', label:'Entrevista etnogr√°fica', turns:[
    {role:'inv', say:'Gracias por recibirme. ¬øPodr√≠a contarme c√≥mo organiza su jornada en el mercado?'},
    {role:'inv', say:'Cuando habla de ‚Äúdeuda‚Äù, ¬øa qu√© se refiere exactamente? ¬øEs monetaria, afectiva o ambas?'},
    {role:'inv', say:'Si piensa en los √∫ltimos a√±os, ¬øqu√© ha cambiado para mejor y para peor?'}
  ]}
];

// Banco de f√≥rmulas ret√≥ricas
const PHRASES = {
  Hedging:[
    'cabr√≠a sostener que‚Ä¶','parece plausible afirmar que‚Ä¶','los datos sugieren, con cautela, que‚Ä¶','no es obvio que‚Ä¶','hasta donde sabemos‚Ä¶','quedan abiertas varias posibilidades‚Ä¶'
  ],
  Conectores:[
    'en primer lugar','por un lado / por otro','no obstante','con todo','a saber','dicho esto','en consecuencia','de ah√≠ que','por ende','en la medida en que'
  ],
  OperadoresArgumentativos:[
    'supongamos, ad argumentandum, que‚Ä¶','consideremos el caso l√≠mite de‚Ä¶','como corolario,','por reducci√≥n al absurdo,','por inducci√≥n estructural,','se sigue que'
  ],
  Latines:[
    'cf.','ibid. / ib√≠d.','op. cit.','infra / supra','sensu lato / sensu stricto','inter alia','mutatis mutandis'
  ],
  Voz:[
    'se observa que‚Ä¶ (impersonal)','es defendible la hip√≥tesis de que‚Ä¶ (pasiva refleja)','conviene se√±alar que‚Ä¶','cabe destacar que‚Ä¶'
  ]
};

// Plantillas
const TEMPLATES = [
  {name:'Resumen/Abstract', content:`Este trabajo [objetivo]. Mediante [m√©todo], [resultado principal]. Argumento que [tesis]. Estas conclusiones [alcance/implicaciones].`},
  {name:'Introducci√≥n (art√≠culo)', content:`(1) Planteamiento del problema. (2) Hueco en la literatura. (3) Contribuci√≥n. (4) Dise√±o y resultados. (5) Estructura del art√≠culo.`},
  {name:'Rese√±a cr√≠tica', content:`Resumen sucinto de la obra; valoraci√≥n de la tesis; discusi√≥n de metodolog√≠a; comparaci√≥n con X; fortalezas y l√≠mites; recomendaci√≥n argumentada.`},
  {name:'Correo a comit√©', content:`Estimado comit√©: adjunto el manuscrito titulado [X]. Agradezco sus comentarios. Quedo atento a cualquier requerimiento adicional. Saludos cordiales.`}
];

// Comparativa gramatical
const COMPARA = [
  ['Hedging', 'Uso extendido de atenuadores para marcar cautela y modestia epist√©mica.', 'Cabr√≠a sostener que los datos no son concluyentes.', 'Evite absolutismos salvo evidencia fuerte.'],
  ['Pasiva/impersonal', 'Preferencia por estructuras con ‚Äúse‚Äù o pasivas perifr√°sticas.', 'Se observa una correlaci√≥n significativa‚Ä¶', 'Personalizar (‚Äúyo‚Äù) solo en reflexiones metodol√≥gicas.'],
  ['Conectores', 'Secuencian el argumento con claridad.', 'No obstante, el segundo experimento matiza el primero.', 'Evite abuso: mejor pocos y pertinentes.'],
  ['Nominalizaci√≥n', 'Frecuente para condensar procesos en entidades.', 'La operacionalizaci√≥n del constructo‚Ä¶', 'Equilibre con verbos claros para evitar opacidad.'],
  ['Registro', 'L√©xico preciso y tono objetivo.', 'Resulta razonable suponer‚Ä¶', 'Evite coloquialismos y muletillas.'],
];

// ======= Utilidades de voz =======
let VOICES = [];
function loadVoices(){
  VOICES = speechSynthesis.getVoices().filter(v=>/es|Spanish/i.test(v.lang));
  const sel = document.getElementById('voiceSelect');
  sel.innerHTML = VOICES.map((v,i)=>`<option value="${i}">${v.name} ‚Äî ${v.lang}</option>`).join('');
}
if ('speechSynthesis' in window){
  loadVoices();
  speechSynthesis.onvoiceschanged = loadVoices;
}
function pickVoice(){
  const idx = +document.getElementById('voiceSelect').value || 0;
  return VOICES[idx] || speechSynthesis.getVoices().find(v=>v.lang.startsWith('es'));
}
function say(lang, text, rate=1){
  if(!('speechSynthesis' in window)) return alert('TTS no disponible en este navegador.');
  const u = new SpeechSynthesisUtterance(text); u.lang = lang; u.rate = rate; u.voice = pickVoice();
  speechSynthesis.speak(u);
}
function stopAllAudio(){ if('speechSynthesis' in window) speechSynthesis.cancel(); if(rec && rec.state==='recording') rec.stop(); if(mediaStream) mediaStream.getTracks().forEach(t=>t.stop()); }
function testVoice(){ say('es-ES','Esta es una prueba de voz para espa√±ol acad√©mico.'); }

// ======= Reconocimiento de voz =======
const SR = window.SpeechRecognition || window.webkitSpeechRecognition;
let recognizer = null, listening=false;
function ensureRecognizer(){
  if(!SR){ document.getElementById('permInfo').textContent = 'Reconocimiento de voz no soportado en este navegador.'; return null; }
  if(!recognizer){
    recognizer = new SR(); recognizer.lang='es-ES'; recognizer.interimResults=true; recognizer.continuous=true;
    recognizer.onresult = e=>{
      let t=''; for(let i=e.resultIndex;i<e.results.length;i++){ t+=e.results[i][0].transcript; }
      handleTranscript(t);
    };
    recognizer.onend = ()=>{listening=false; updateStatus('Micr√≥fono','apagado');};
  }
  return recognizer;
}
function toggleMic(){
  const r = ensureRecognizer(); if(!r) return;
  if(!listening){ r.start(); listening=true; updateStatus('Micr√≥fono','escuchando'); }
  else { r.stop(); listening=false; }
}

// ======= SRS (SM-2 simplificado) =======
let SRS = JSON.parse(localStorage.getItem('srsDeck')||'[]');
function saveSRS(){ localStorage.setItem('srsDeck', JSON.stringify(SRS)); updateSRSInfo(); }
function resetSRS(){ if(confirm('¬øReiniciar todas las tarjetas?')){ SRS=[]; saveSRS(); renderSRS(); }}
function startSRSFromLexicon(){
  const rows = currentLexRows; // √∫ltimas filas renderizadas
  const now = Date.now();
  rows.forEach(r=>{
    if(!SRS.find(x=>x.id===r.id)) SRS.push({id:r.id, due:now, ivl:1, ease:2.5, lapses:0});
  });
  saveSRS(); renderSRS(); alert('A√±adidas '+rows.length+' tarjetas.');
}
function srsGenerateSample(){
  const pick = [...LEXICON].sort(()=>Math.random()-0.5).slice(0,12);
  const now = Date.now(); pick.forEach(r=>{ if(!SRS.find(x=>x.id===r.id)) SRS.push({id:r.id, due:now, ivl:1, ease:2.5, lapses:0}); });
  saveSRS(); renderSRS();
}
function dueCards(){ const now=Date.now(); return SRS.filter(c=>c.due<=now); }
function gradeCard(card, q){ // q: 0-3 (malo a excelente)
  if(q<2){ card.ivl=1; card.due=Date.now()+24*3600*1000; card.lapses++; card.ease=Math.max(1.3, card.ease-0.2); }
  else { card.ease+= (q===3?0.15:0); card.ivl = Math.round(card.ivl * card.ease); card.due = Date.now() + card.ivl*24*3600*1000; }
}
function renderSRS(){
  const box = document.getElementById('srsCard');
  const due = dueCards();
  if(due.length===0){ box.innerHTML = '<p class="muted">No hay tarjetas vencidas. A√±ada m√°s desde el L√©xico.</p>'; return; }
  const card = due[0]; const item = LEXICON.find(x=>x.id===card.id);
  const mode = (document.getElementById('lexMode')||{value:'es-en'}).value;
  const q = mode==='es-en' ? `<div class="pill">ES</div><h3>${item.es}</h3>` : `<div class="pill">EN</div><h3>${item.en}</h3>`;
  const a = mode==='es-en' ? `<div class="pill">EN</div><p>${item.en}</p>` : `<div class="pill">ES</div><p>${item.es}</p>`;
  box.innerHTML = `
    <div>${q}</div>
    <details style="margin:8px 0"><summary>Mostrar respuesta</summary>${a}<p class="small muted">${item.def}</p><p class="small">Ej.: ${item.ex}</p></details>
    <div class="row">
      <button class="btn danger" onclick="gradeAndNext(${card.id},0)">Dif√≠cil</button>
      <button class="btn warn" onclick="gradeAndNext(${card.id},1)">Dudosa</button>
      <button class="btn" onclick="gradeAndNext(${card.id},2)">Bien</button>
      <button class="btn good" onclick="gradeAndNext(${card.id},3)">Excelente</button>
      <button class="btn right" onclick="say('es-ES','${item.es.replace(/"/g,'')}')">‚ñ∂Ô∏é Pronunciar</button>
    </div>`;
}
function gradeAndNext(id, q){ const c=SRS.find(x=>x.id===id); gradeCard(c,q); saveSRS(); renderSRS(); incProgress(); }
function updateSRSInfo(){ const info=document.getElementById('srsInfo'); if(info) info.textContent = `${SRS.length} tarjetas ‚Äî ${dueCards().length} vencidas`; }

// ======= L√©xico: render =======
let currentLexRows = [];
function renderLexicon(){
  const q = (document.getElementById('lexSearch').value||'').toLowerCase();
  const d = (document.getElementById('lexDomain').value||'');
  const rows = LEXICON.filter(r=>(!d||r.dom===d) && (r.es.toLowerCase().includes(q) || r.en.toLowerCase().includes(q) || r.ex.toLowerCase().includes(q) || r.def.toLowerCase().includes(q)));
  currentLexRows = rows;
  const thead = `<tr><th>Dominio</th><th>ES</th><th>EN</th><th>Definici√≥n</th><th>Ejemplo</th><th>Colocaciones</th></tr>`;
  const tbody = rows.map(r=>`<tr><td>${r.dom}</td><td><strong>${r.es}</strong><div class="small muted">/${r.ipa||''}/</div></td><td>${r.en}</td><td>${r.def}</td><td>${r.ex}</td><td>${(r.col||[]).map(c=>`<span class='pill'>${c}</span>`).join('')}</td></tr>`).join('');
  document.getElementById('lexTable').innerHTML = thead+tbody;
  document.getElementById('lexCount').textContent = `${rows.length} t√©rminos mostrados`;
}

// ======= Cloze =======
function populateClozeSrc(){
  const sel = document.getElementById('clozeSrc'); sel.innerHTML = PASSAGES.map(p=>`<option value="${p.id}">${p.title}</option>`).join('');
}
function makeCloze(){
  const id = document.getElementById('clozeSrc').value; const p = PASSAGES.find(x=>x.id===id).text;
  const targets = ['no obstante','por ende','en consecuencia','cabr√≠a','parece plausible','se observa','hip√≥tesis','metodol√≥gica'];
  let out = p; targets.forEach(t=>{ const re = new RegExp(t,'gi'); out = out.replace(re, '____'); });
  document.getElementById('clozeArea').innerHTML = `<p>${out}</p><p class='hint'>Complete las elipsis seg√∫n convenga al argumento.</p>`;
}

// ======= Di√°logos =======
function populateDialogues(){
  const sel = document.getElementById('dialogueSelect'); sel.innerHTML = DIALOGUES.map(d=>`<option value="${d.id}">${d.label}</option>`).join('');
}
function playDialogue(){
  const id = document.getElementById('dialogueSelect').value; const d = DIALOGUES.find(x=>x.id===id);
  const area = document.getElementById('dialogueArea'); area.innerHTML = '';
  let i=0;
  function step(){ if(i>=d.turns.length) return; const t=d.turns[i++]; const div=document.createElement('div'); div.className='card'; div.style.margin='8px 0'; div.innerHTML=`<div class='row'><div class='pill'>${t.role}</div><div>${t.say}</div></div>`; area.appendChild(div); say('es-ES', t.say, 1); }
  stopAllAudio(); i=0; step(); let iv = setInterval(()=>{ if(!speechSynthesis.speaking){ if(i<d.turns.length) step(); else clearInterval(iv); } }, 600);
}

// ======= Shadowing =======
function populateShadow(){ const sel=document.getElementById('shadowSelect'); sel.innerHTML = PASSAGES.map(p=>`<option value="${p.id}">${p.title}</option>`).join(''); updateShadowText(); }
function updateShadowText(){ const id=document.getElementById('shadowSelect').value; const p=PASSAGES.find(x=>x.id===id)||PASSAGES[0]; document.getElementById('shadowText').innerHTML = `<h3>${p.title}</h3><p>${p.text}</p>`; }
function ttsShadow(){ const id=document.getElementById('shadowSelect').value; const p=PASSAGES.find(x=>x.id===id)||PASSAGES[0]; stopAllAudio(); say('es-ES', p.text, 0.98); }

// Grabaci√≥n, onda y m√©tricas
let mediaStream, rec, chunks=[], audioCtx, analyser, dataArray, raf;
const canvas = document.getElementById('waveCanvas'); const ctx = canvas.getContext('2d');
function recShadow(){
  if(!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) return alert('getUserMedia no disponible.');
  navigator.mediaDevices.getUserMedia({audio:true}).then(stream=>{
    mediaStream = stream; audioCtx = new (window.AudioContext||window.webkitAudioContext)();
    const src = audioCtx.createMediaStreamSource(stream); analyser = audioCtx.createAnalyser(); analyser.fftSize=2048; dataArray=new Uint8Array(analyser.fftSize); src.connect(analyser);
    drawWave();
    rec = new MediaRecorder(stream); chunks=[]; const t0=performance.now(); let words=0; let lastTranscript='';
    rec.ondataavailable = e=>chunks.push(e.data);
    rec.onstop = ()=>{
      cancelAnimationFrame(raf); const blob=new Blob(chunks,{type:'audio/webm'}); const url=URL.createObjectURL(blob);
      const a=document.createElement('audio'); a.controls=true; a.src=url; document.getElementById('shadowText').appendChild(a);
      const dur=(performance.now()-t0)/1000; document.getElementById('dur').textContent = dur.toFixed(1);
      const txt = (document.getElementById('lastTranscript')?.textContent||'').trim(); words = txt? txt.split(/\s+/).length : 0;
      document.getElementById('wcount').textContent = words;
      document.getElementById('wpm').textContent = dur>0? Math.round((words/(dur/60))) : 0;
    };
    rec.start();
    if(ensureRecognizer()){ recognizer.start(); listening=true; }
  }).catch(err=>alert('Permiso de micr√≥fono denegado: '+err.message));
}
function drawWave(){
  raf = requestAnimationFrame(drawWave);
  analyser.getByteTimeDomainData(dataArray);
  ctx.clearRect(0,0,canvas.width,canvas.height); ctx.beginPath();
  for(let i=0;i<canvas.width;i++){
    const v = dataArray[Math.floor(i/(canvas.width)*dataArray.length)]/128.0-1.0;
    const y = (canvas.height/2) + v*(canvas.height/2-4);
    if(i===0) ctx.moveTo(0,y); else ctx.lineTo(i,y);
  }
  ctx.strokeStyle = 'rgba(56,189,248,.9)'; ctx.lineWidth=2; ctx.stroke();
  // RMS simple
  let sum=0; for(let i=0;i<dataArray.length;i++){ const dv=(dataArray[i]/255)-0.5; sum+=dv*dv; }
  const rms=Math.sqrt(sum/dataArray.length); document.getElementById('rms').textContent = rms.toFixed(2);
}

// Transcripci√≥n live ‚Üí indicador (sincroniza en Di√°logos y Shadowing)
function handleTranscript(t){
  let a = document.getElementById('lastTranscriptDlg');
  if(!a){ a=document.createElement('div'); a.id='lastTranscriptDlg'; a.className='mono small'; document.getElementById('dialogueArea')?.appendChild(a); }
  let b = document.getElementById('lastTranscriptSh');
  if(!b){ b=document.createElement('div'); b.id='lastTranscriptSh'; b.className='mono small'; document.getElementById('shadowText')?.appendChild(b); }
  a.textContent = t; b.textContent = t;
}

// ======= Writing Lab transforms =======
const replacements = [
  [/\bcreo que\b/gi, 'sostengo que'],
  [/\bpienso que\b/gi, 'parece plausible afirmar que'],
  [/\bcosas\b/gi, 'aspectos'],
  [/\bproblema\b/gi, 'cuesti√≥n'],
  [/\btrata de\b/gi, 'aborda'],
  [/\bda\b/gi, 'proporciona'],
  [/\bhay\b/gi, 'se observa'],
  [/\bcomo\b/gi, 'a saber'],
  [/\bpero\b/gi, 'no obstante'],
  [/\bpor eso\b/gi, 'por ende'],
];
function elevateRegister(){
  let t = document.getElementById('writeIn').value || '';
  replacements.forEach(([re,sub])=> t = t.replace(re, sub));
  // A√±adir impersonalizaci√≥n ligera
  t = t.replace(/\byo\b/gi,''); t = t.replace(/\bnosotros\b/gi,'');
  // Compactar espacios
  t = t.replace(/\s{2,}/g,' ').trim();
  document.getElementById('writeOut').value = t;
}
function paraphraseHedge(){
  const hed = PHRASES.Hedging; const pick = ()=>hed[Math.floor(Math.random()*hed.length)];
  const t = document.getElementById('writeOut').value || document.getElementById('writeIn').value || '';
  document.getElementById('writeOut').value = `${pick()}, ${t}`;
}
function formalizeCitations(){
  let t = document.getElementById('writeOut').value || document.getElementById('writeIn').value || '';
  t = t.replace(/\(ver\s+([^)]+)\)/gi,'[cf. $1]');
  t = t.replace(/\b(entre otras cosas)\b/gi,'inter alia');
  document.getElementById('writeOut').value = t;
}

// ======= Phrase bank render =======
function renderPhraseBank(){
  const box = document.getElementById('phraseBank');
  box.innerHTML = Object.entries(PHRASES).map(([k,arr])=>{
    return `<h3>${k}</h3><div class='chips'>${arr.map(x=>`<button class='chip' onclick=\"insertPhrase('${x.replace(/'/g,"\\'")}')\">${x}</button>`).join('')}</div>`;
  }).join('');
}
function insertPhrase(str){ const el=document.getElementById('writeIn'); el.value = (el.value? el.value+ ' ' : '') + str; }

// ======= Templates render =======
function renderTemplates(){
  const box = document.getElementById('tpls');
  box.innerHTML = '';
  TEMPLATES.forEach(t=>{
    const card = document.createElement('div'); card.className='card';
    card.innerHTML = `<h3>${t.name}</h3><p class='small muted'>Haga clic para copiar.</p><pre class='mono small' style='white-space:pre-wrap'>${t.content}</pre><button class='btn' data-copy='1'>Copiar</button>`;
    card.querySelector('button').addEventListener('click', ()=> copyText(t.content));
    box.appendChild(card);
  });
}

function copyText(txt){ navigator.clipboard?.writeText(txt); }

// ======= Comparativa render =======
function renderComparativa(){
  const tb = document.getElementById('compTable');
  tb.innerHTML = COMPARA.map(r=>`<tr><td>${r[0]}</td><td>${r[1]}</td><td>${r[2]}</td><td>${r[3]}</td></tr>`).join('');
}

// ======= Export/Import =======
function exportData(){
  const data = {SRS, settings:{voice:document.getElementById('voiceSelect').value}, progress:parseInt(localStorage.getItem('progress')||'0') };
  const blob = new Blob([JSON.stringify(data,null,2)], {type:'application/json'});
  const a = document.createElement('a'); a.href = URL.createObjectURL(blob); a.download = 'es-academico-datos.json'; a.click();
}
function importData(){
  const f = document.getElementById('importFile').files[0]; if(!f) return alert('Seleccione un archivo JSON.');
  const reader = new FileReader(); reader.onload = ()=>{
    try{ const data=JSON.parse(reader.result);
      SRS = data.SRS||[]; saveSRS(); document.getElementById('voiceSelect').value = data.settings?.voice||0; localStorage.setItem('progress', data.progress||0); updateProgressBar(); renderSRS(); alert('Datos importados.');
    }catch(e){ alert('JSON inv√°lido.'); }
  }; reader.readAsText(f);
}

// ======= Progreso =======
function incProgress(){ let p=+localStorage.getItem('progress')||0; p=Math.min(100,p+5); localStorage.setItem('progress', p); updateProgressBar(); }
function updateProgressBar(){ const p=+localStorage.getItem('progress')||0; document.getElementById('progressBar').style.width = p+'%'; }

// ======= Estado del sistema =======
function updateStatus(k,v){ const ul=document.getElementById('sysStatus'); const id='st-'+k; let li=document.getElementById(id); if(!li){ li=document.createElement('li'); li.id=id; ul.appendChild(li);} li.innerHTML = `<span class='pill'>${k}</span> ${v}`; }

// ======= Accesos r√°pidos =======
function startSeminar(){ openTab('dialogues'); document.getElementById('dialogueSelect').value='seminario'; playDialogue(); }

// ======= Init =======
function init(){
  renderLexicon(); updateSRSInfo(); renderSRS(); populateClozeSrc(); populateDialogues(); populateShadow(); renderPhraseBank(); renderTemplates(); renderComparativa(); updateProgressBar(); updateShadowText();
  // Status
  updateStatus('TTS', 'disponible: '+('speechSynthesis' in window));
  updateStatus('Reconocimiento', (SR? 'soportado' : 'no soportado'));
  updateStatus('Secure Context', (window.isSecureContext? 's√≠' : 'no (algunas funciones de micr√≥fono requieren https)'));
  document.getElementById('shadowSelect').addEventListener('change', updateShadowText);
  document.addEventListener('keydown', e=>{ if(e.code==='Space'){ e.preventDefault(); if(speechSynthesis.speaking) speechSynthesis.pause(); else speechSynthesis.resume(); } if(e.key.toLowerCase()==='m'){ toggleMic(); }});
}
init();
</script>
</body>
</html>
