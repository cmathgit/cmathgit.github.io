<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cyber-West Chess</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/chess.js/0.10.3/chess.min.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&family=Rye&display=swap" rel="stylesheet">
    <style>
        :root {
            --lawmen-color: #00ffff; /* Cyan */
            --outlaw-color: #ff00ff; /* Magenta */
            --board-dark: #3a2e25; /* Dusty dark brown */
            --board-light: #8b7355; /* Lighter sand color */
            --bg-color: #120a06;
            --text-color: #e0e0e0;
        }

        /* Define custom fonts */
        .font-rye { font-family: 'Rye', cursive; }
        .font-orbitron { font-family: 'Orbitron', sans-serif; }
        
        /* Body styling with a subtle texture */
        body {
            background-color: var(--bg-color);
            background-image: url('data:image/svg+xml,%3Csvg xmlns="http://www.w3.org/2000/svg" width="40" height="40" viewBox="0 0 40 40"%3E%3Cg fill-rule="evenodd"%3E%3Cg fill="%239C92AC" fill-opacity="0.05"%3E%3Cpath d="M0 38.59l2.83-2.83 1.41 1.41L1.41 40H0v-1.41zM0 1.4l2.83 2.83 1.41-1.41L1.41 0H0v1.41zM38.59 40l-2.83-2.83 1.41-1.41L40 38.59V40h-1.41zM40 1.41l-2.83 2.83-1.41-1.41L38.59 0H40v1.41zM20 18.6l2.83-2.83 1.41 1.41L21.41 20l2.83 2.83-1.41 1.41L20 21.41l-2.83 2.83-1.41-1.41L18.59 20l-2.83-2.83 1.41-1.41L20 18.59z"/%3E%3C/g%3E%3C/g%3E%3C/svg%3E');
        }

        /* Chess board styling */
        .board {
            display: grid;
            grid-template-columns: repeat(8, 1fr);
            border: 2px solid var(--lawmen-color);
            box-shadow: 0 0 15px var(--lawmen-color), inset 0 0 15px rgba(0, 255, 255, 0.5);
            transition: transform 0.8s cubic-bezier(0.68, -0.55, 0.27, 1.55);
            transform-style: preserve-3d;
        }

        .board.flipped {
            transform: rotateY(180deg);
        }

        .square {
            position: relative;
            aspect-ratio: 1;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        /* Chess piece styling */
        .piece {
            width: 80%;
            height: 80%;
            cursor: grab;
            transition: transform 0.2s, filter 0.2s;
            z-index: 10;
        }
        
        .piece.w .piece-glow { filter: drop-shadow(0 0 5px var(--lawmen-color)); }
        .piece.b .piece-glow { filter: drop-shadow(0 0 5px var(--outlaw-color)); }
        .piece.w .piece-main { stroke: var(--lawmen-color); }
        .piece.b .piece-main { stroke: var(--outlaw-color); }

        .selected {
            transform: scale(1.1);
            filter: drop-shadow(0 0 8px #fff700);
        }

        /* Square highlighting */
        .valid-move::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 30%;
            height: 30%;
            border-radius: 50%;
            background: var(--lawmen-color);
            opacity: 0.6;
            animation: pulse 1.5s infinite;
        }
        
        .highlight-check {
            animation: check-pulse 1.2s infinite;
        }

        /* Animation keyframes */
        @keyframes pulse {
            0% { transform: translate(-50%,-50%) scale(0.9); opacity: 0.6; }
            50% { transform: translate(-50%,-50%) scale(1.2); opacity: 0.9; }
            100% { transform: translate(-50%,-50%) scale(0.9); opacity: 0.6; }
        }

        @keyframes check-pulse {
            0% { box-shadow: inset 0 0 20px rgba(255, 0, 0, 0.5); }
            50% { box-shadow: inset 0 0 35px rgba(255, 0, 0, 1); }
            100% { box-shadow: inset 0 0 20px rgba(255, 0, 0, 0.5); }
        }
        
        .glitch {
            animation: glitch 1.5s linear infinite;
        }

        @keyframes glitch {
            2%,64%{ transform: translate(2px,0) skew(0deg); }
            4%,60%{ transform: translate(-2px,0) skew(0deg); }
            62%{ transform: translate(0,0) skew(5deg); }
        }
        .glitch:before, .glitch:after {
            content: attr(data-text);
            position: absolute;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background: transparent;
            overflow: hidden;
        }
        .glitch:before {
            left: 3px;
            text-shadow: -2px 0 var(--lawmen-color);
            clip: rect(44px, 450px, 56px, 0);
            animation: glitch-anim 5s infinite linear alternate-reverse;
        }
        .glitch:after {
            left: -3px;
            text-shadow: -2px 0 var(--outlaw-color);
            clip: rect(85px, 450px, 90px, 0);
            animation: glitch-anim2 3s infinite linear alternate-reverse;
        }
        @keyframes glitch-anim {
            0% { clip: rect(42px, 9999px, 44px, 0); }
            /* ... more steps ... */
            100% { clip: rect(42px, 9999px, 44px, 0); }
        }
        @keyframes glitch-anim2 {
            0% { clip: rect(20px, 9999px, 98px, 0); }
            /* ... more steps ... */
            100% { clip: rect(20px, 9999px, 98px, 0); }
        }
        
        /* Modal styling */
        .modal-backdrop {
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background-color: rgba(0,0,0,0.7);
            backdrop-filter: blur(5px);
            z-index: 40;
        }
        .modal-content {
            z-index: 50;
            border: 1px solid var(--lawmen-color);
            box-shadow: 0 0 20px var(--lawmen-color);
        }
    </style>
</head>
<body class="bg-gray-900 text-gray-200 font-orbitron antialiased">
    <!-- SVG Piece Definitions -->
    <svg width="0" height="0" style="position:absolute;z-index:-1;">
        <defs>
            <!-- Lawmen (White) Pieces -->
            <symbol id="wp" viewBox="0 0 100 100"><g class="piece-glow"><path class="piece-main" d="M50 15 L50 30 M50 30 A20 20 0 1 1 50 70 A20 20 0 1 1 50 30 M30 75 L70 75 L70 85 L30 85 Z" fill="none" stroke-width="5" stroke-linecap="round" stroke-linejoin="round"/></g></symbol>
            <symbol id="wr" viewBox="0 0 100 100"><g class="piece-glow"><path class="piece-main" d="M25 20 L25 80 L75 80 L75 20 M20 20 L80 20 M35 20 L35 35 M65 20 L65 35" fill="none" stroke-width="5" stroke-linecap="round" stroke-linejoin="round"/></g></symbol>
            <symbol id="wn" viewBox="0 0 100 100"><g class="piece-glow"><path class="piece-main" d="M30 80 C 40 40, 70 40, 80 80 M25 30 C 40 20, 60 20, 70 40 L50 60" fill="none" stroke-width="5" stroke-linecap="round" stroke-linejoin="round"/></g></symbol>
            <symbol id="wb" viewBox="0 0 100 100"><g class="piece-glow"><path class="piece-main" d="M50 15 L65 45 L35 45 Z M50 15 L50 85 M30 85 L70 85" fill="none" stroke-width="5" stroke-linecap="round" stroke-linejoin="round"/></g></symbol>
            <symbol id="wq" viewBox="0 0 100 100"><g class="piece-glow"><path class="piece-main" d="M25 30 L75 30 L50 60 Z M50 15 L50 85 M25 85 L75 85 M20 20 L80 20" fill="none" stroke-width="5" stroke-linecap="round" stroke-linejoin="round"/></g></symbol>
            <symbol id="wk" viewBox="0 0 100 100"><g class="piece-glow"><path class="piece-main" d="M50 10 L50 30 M40 20 L60 20 M25 35 L75 35 L75 85 L25 85 Z M50 35 L50 85 M25 60 L75 60" fill="none" stroke-width="5" stroke-linecap="round" stroke-linejoin="round"/></g></symbol>
            <!-- Outlaw (Black) Pieces -->
            <symbol id="bp" viewBox="0 0 100 100"><g class="piece-glow"><path class="piece-main" d="M50 15 L50 30 M50 30 A20 20 0 1 1 50 70 A20 20 0 1 1 50 30 M30 75 L70 75 L70 85 L30 85 Z" fill="none" stroke-width="5" stroke-linecap="round" stroke-linejoin="round"/></g></symbol>
            <symbol id="br" viewBox="0 0 100 100"><g class="piece-glow"><path class="piece-main" d="M25 20 L25 80 L75 80 L75 20 M20 20 L80 20 M35 20 L35 35 M65 20 L65 35" fill="none" stroke-width="5" stroke-linecap="round" stroke-linejoin="round"/></g></symbol>
            <symbol id="bn" viewBox="0 0 100 100"><g class="piece-glow"><path class="piece-main" d="M30 80 C 40 40, 70 40, 80 80 M25 30 C 40 20, 60 20, 70 40 L50 60" fill="none" stroke-width="5" stroke-linecap="round" stroke-linejoin="round"/></g></symbol>
            <symbol id="bb" viewBox="0 0 100 100"><g class="piece-glow"><path class="piece-main" d="M50 15 L65 45 L35 45 Z M50 15 L50 85 M30 85 L70 85" fill="none" stroke-width="5" stroke-linecap="round" stroke-linejoin="round"/></g></symbol>
            <symbol id="bq" viewBox="0 0 100 100"><g class="piece-glow"><path class="piece-main" d="M25 30 L75 30 L50 60 Z M50 15 L50 85 M25 85 L75 85 M20 20 L80 20" fill="none" stroke-width="5" stroke-linecap="round" stroke-linejoin="round"/></g></symbol>
            <symbol id="bk" viewBox="0 0 100 100"><g class="piece-glow"><path class="piece-main" d="M50 10 L50 30 M40 20 L60 20 M25 35 L75 35 L75 85 L25 85 Z M50 35 L50 85 M25 60 L75 60" fill="none" stroke-width="5" stroke-linecap="round" stroke-linejoin="round"/></g></symbol>
        </defs>
    </svg>

    <div class="min-h-screen w-full flex flex-col items-center justify-center p-2 sm:p-4">
        <!-- Header -->
        <header class="w-full max-w-2xl text-center mb-4">
            <h1 class="font-rye text-4xl sm:text-6xl text-amber-300 glitch" data-text="Cyber-West Chess">Cyber-West Chess</h1>
            <p class="text-sm sm:text-base text-cyan-300">A showdown at the digital frontier.</p>
        </header>

        <!-- Main Game Area -->
        <main class="w-full flex flex-col lg:flex-row items-center justify-center gap-4">
            <!-- Game Board -->
            <div id="board-container" class="w-full max-w-lg aspect-square">
                <div id="board" class="board aspect-square"></div>
            </div>

            <!-- Controls and Status -->
            <div class="w-full lg:w-64 flex flex-col gap-4 p-4 rounded-lg border border-pink-500/50 bg-black/30 backdrop-blur-sm">
                <div id="status" class="text-lg text-center h-16 p-2 border border-cyan-400/50 rounded-md flex items-center justify-center">Select Game Mode</div>
                
                <div class="flex flex-col gap-2">
                    <label for="gameMode" class="text-sm">Game Mode:</label>
                    <select id="gameMode" class="bg-gray-800 border border-gray-600 rounded p-2 focus:outline-none focus:ring-2 focus:ring-cyan-400">
                        <option value="human">Versus Human</option>
                        <option value="ai">Versus AI</option>
                    </select>
                </div>

                <button id="newGameBtn" class="w-full bg-cyan-600 hover:bg-cyan-500 text-black font-bold py-2 px-4 rounded transition-all duration-300 shadow-[0_0_10px_var(--lawmen-color)]">New Game</button>
                <div class="text-xs text-center text-gray-400">
                    <p>Lawmen (Cyan) vs Outlaws (Magenta)</p>
                </div>
            </div>
        </main>
    </div>

    <!-- Promotion Modal -->
    <div id="promotion-modal" class="hidden">
        <div class="modal-backdrop"></div>
        <div class="modal-content fixed top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 bg-gray-900 p-6 rounded-lg flex gap-4">
            <!-- Promotion pieces will be injected here -->
        </div>
    </div>


    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const boardElement = document.getElementById('board');
            const statusElement = document.getElementById('status');
            const newGameBtn = document.getElementById('newGameBtn');
            const gameModeSelect = document.getElementById('gameMode');
            const promotionModal = document.getElementById('promotion-modal');
            const modalContent = promotionModal.querySelector('.modal-content');

            let game = new Chess();
            let board = null;
            let selectedPiece = null;
            let highlightedSquares = [];
            let gameMode = 'human';
            let playerColor = 'w';
            let isBoardFlipped = false;
            let promotionData = null; // { from, to, color }
            
            // --- Game Initialization ---
            function initializeGame() {
                game = new Chess();
                gameMode = gameModeSelect.value;
                playerColor = 'w';
                isBoardFlipped = false;
                boardElement.classList.remove('flipped');
                renderBoard();
                updateStatus();
            }
            
            newGameBtn.addEventListener('click', initializeGame);

            // --- Board Rendering ---
            function renderBoard() {
                boardElement.innerHTML = '';
                let kingInCheckSquare = null;
                if (game.in_check()) {
                    const kingPos = findKing(game.turn());
                    if (kingPos) kingInCheckSquare = kingPos;
                }

                for (let rank = 7; rank >= 0; rank--) {
                    for (let file = 0; file < 8; file++) {
                        const squareName = String.fromCharCode('a'.charCodeAt(0) + file) + (rank + 1);
                        const square = document.createElement('div');
                        square.classList.add('square');
                        square.dataset.square = squareName;

                        const isDark = (rank + file) % 2 !== 0;
                        square.style.backgroundColor = isDark ? 'var(--board-dark)' : 'var(--board-light)';

                        const piece = game.get(squareName);
                        if (piece) {
                            const pieceElement = document.createElement('div');
                            pieceElement.classList.add('piece', piece.color + piece.type, piece.color);
                            pieceElement.innerHTML = `<svg><use xlink:href="#${piece.color}${piece.type}"></use></svg>`;
                            square.appendChild(pieceElement);
                        }
                        
                        if (squareName === kingInCheckSquare) {
                            square.classList.add('highlight-check');
                        }

                        square.addEventListener('click', () => onSquareClick(squareName));
                        boardElement.appendChild(square);
                    }
                }
            }
            
            function findKing(color) {
                const boardState = game.board();
                for (let r = 0; r < boardState.length; r++) {
                    for (let c = 0; c < boardState[r].length; c++) {
                        const p = boardState[r][c];
                        if (p && p.type === 'k' && p.color === color) {
                            return p.square;
                        }
                    }
                }
                return null;
            }


            // --- User Interaction ---
            function onSquareClick(squareName) {
                if (game.game_over()) return;
                
                // If AI's turn, do nothing
                if (gameMode === 'ai' && game.turn() !== playerColor) return;

                const piece = game.get(squareName);

                if (selectedPiece) {
                    const move = game.move({
                        from: selectedPiece.dataset.square,
                        to: squareName,
                        promotion: 'q' // Default promotion, will be handled by modal
                    });

                    if (move) {
                        if (move.flags.includes('p')) { // Pawn promotion
                            game.undo(); // Undo the default promotion move
                            handlePromotion(move.from, move.to, move.color);
                        } else {
                            handleMoveMade();
                        }
                    } else {
                        clearHighlights();
                        selectedPiece.classList.remove('selected');
                        selectedPiece = null;
                    }
                } else if (piece && piece.color === game.turn()) {
                    selectPiece(squareName);
                }
            }

            function selectPiece(squareName) {
                clearHighlights();
                const squareElement = getSquareElement(squareName);
                selectedPiece = squareElement.querySelector('.piece');
                if (selectedPiece) {
                    selectedPiece.classList.add('selected');
                    selectedPiece.dataset.square = squareName;
                    highlightValidMoves(squareName);
                }
            }

            function highlightValidMoves(squareName) {
                const moves = game.moves({ square: squareName, verbose: true });
                highlightedSquares = moves.map(move => move.to);
                highlightedSquares.forEach(sq => {
                    getSquareElement(sq).classList.add('valid-move');
                });
            }

            function clearHighlights() {
                highlightedSquares.forEach(sq => {
                    const el = getSquareElement(sq);
                    if(el) el.classList.remove('valid-move');
                });
                highlightedSquares = [];
                if (selectedPiece) {
                    selectedPiece.classList.remove('selected');
                    selectedPiece = null;
                }
            }

            // --- Game Logic and Flow ---
            function handleMoveMade() {
                clearHighlights();
                renderBoard();
                updateStatus();

                if (game.game_over()) return;

                if (gameMode === 'human') {
                    // Flip board for next player
                    setTimeout(() => {
                        isBoardFlipped = !isBoardFlipped;
                        boardElement.classList.toggle('flipped', isBoardFlipped);
                    }, 500);
                } else if (game.turn() !== playerColor) {
                    // AI's turn
                    setTimeout(makeAIMove, 500);
                }
            }

            function updateStatus() {
                let statusText = '';
                const moveColor = game.turn() === 'w' ? 'Lawmen (Cyan)' : 'Outlaws (Magenta)';

                if (game.game_over()) {
                    if (game.in_checkmate()) {
                        statusText = `Checkmate! ${moveColor} vanquished.`;
                    } else if (game.in_draw()) {
                        statusText = "Draw! A stalemate at the frontier.";
                    }
                    statusElement.classList.add('glitch');
                    statusElement.dataset.text = statusText;
                } else {
                    statusText = `${moveColor}'s move.`;
                    if (game.in_check()) {
                        statusText += ' In check!';
                    }
                    statusElement.classList.remove('glitch');
                }
                statusElement.textContent = statusText;
            }
            
            // --- Pawn Promotion ---
            function handlePromotion(from, to, color) {
                promotionData = { from, to };
                modalContent.innerHTML = '';
                const pieces = ['q', 'r', 'n', 'b'];
                pieces.forEach(p => {
                    const promoPiece = document.createElement('div');
                    promoPiece.classList.add('piece', color + p, color, 'cursor-pointer', 'w-16', 'h-16');
                    promoPiece.innerHTML = `<svg><use xlink:href="#${color}${p}"></use></svg>`;
                    promoPiece.addEventListener('click', () => {
                        completePromotion(p);
                    });
                    modalContent.appendChild(promoPiece);
                });
                promotionModal.classList.remove('hidden');
            }

            function completePromotion(piece) {
                if (!promotionData) return;
                game.move({
                    from: promotionData.from,
                    to: promotionData.to,
                    promotion: piece
                });
                promotionModal.classList.add('hidden');
                promotionData = null;
                handleMoveMade();
            }

            // --- AI Logic (Simple) ---
            function makeAIMove() {
                const possibleMoves = game.moves();
                if (possibleMoves.length === 0) return;

                // Simple evaluation: capture > check > random
                let bestMove = null;
                let bestValue = -Infinity;

                possibleMoves.forEach(move => {
                    let moveValue = 0;
                    // Check for captures
                    if (move.includes('x')) moveValue += 10;
                    // Check for checks
                    if (move.includes('+')) moveValue += 5;
                     // Add a random factor to avoid deterministic play
                    moveValue += Math.random();

                    if (moveValue > bestValue) {
                        bestValue = moveValue;
                        bestMove = move;
                    }
                });

                game.move(bestMove || possibleMoves[Math.floor(Math.random() * possibleMoves.length)]);
                handleMoveMade();
            }
            
            // --- Utility Functions ---
            function getSquareElement(squareName) {
                return boardElement.querySelector(`[data-square='${squareName}']`);
            }

            // --- Start the game ---
            initializeGame();
        });
    </script>
</body>
</html>
